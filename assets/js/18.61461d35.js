(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{605:function(a,t,e){"use strict";e.r(t);var r=e(17),s=Object(r.a)({},(function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[e("h1",{attrs:{id:"rabbitmq-federation-插件使用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#rabbitmq-federation-插件使用"}},[a._v("#")]),a._v(" RabbitMQ Federation 插件使用")]),a._v(" "),e("p"),e("div",{staticClass:"table-of-contents"},[e("ul",[e("li",[e("a",{attrs:{href:"#rabbitmq-federation-插件使用"}},[a._v("RabbitMQ Federation 插件使用")]),e("ul",[e("li",[e("a",{attrs:{href:"#概述"}},[a._v("概述")]),e("ul",[e("li",[e("a",{attrs:{href:"#使用场景"}},[a._v("使用场景")])]),e("li",[e("a",{attrs:{href:"#federation-种类"}},[a._v("Federation 种类")]),e("ul",[e("li",[e("a",{attrs:{href:"#exchange-federation"}},[a._v("Exchange Federation")])]),e("li",[e("a",{attrs:{href:"#queue-federation"}},[a._v("Queue Federation")])])])])])]),e("li",[e("a",{attrs:{href:"#使用前提"}},[a._v("使用前提")])]),e("li",[e("a",{attrs:{href:"#federation-exchange-使用"}},[a._v("Federation Exchange 使用")]),e("ul",[e("li",[e("a",{attrs:{href:"#upstream-上游集群配置"}},[a._v("upstream 上游集群配置")])]),e("li",[e("a",{attrs:{href:"#downstream-下游集群配置"}},[a._v("downstream 下游集群配置")])]),e("li",[e("a",{attrs:{href:"#测试"}},[a._v("测试")])])])]),e("li",[e("a",{attrs:{href:"#参考资料"}},[a._v("参考资料")])])])])])]),e("p"),a._v(" "),e("h2",{attrs:{id:"概述"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#概述"}},[a._v("#")]),a._v(" 概述")]),a._v(" "),e("p",[a._v("RabbitMQ Federation 插件可以将消息从一个 Exchange 复制到另一个 Exchange，或从一个 Queue 分发到另一个 Queue。")]),a._v(" "),e("p",[a._v("复制的源端被称为 upstream，复制的目的端被称为 downstream。要使用 Federation 插件，需要在两个集群都开启 Federation 插件，并且在 downstream 集群创建 Federation，配置 upstream。")]),a._v(" "),e("h3",{attrs:{id:"使用场景"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用场景"}},[a._v("#")]),a._v(" 使用场景")]),a._v(" "),e("ul",[e("li",[a._v("将多个集群的消息收集到一个集群")]),a._v(" "),e("li",[a._v("将一个队列的压力分散到多个集群")]),a._v(" "),e("li",[a._v("在不下线的情况下将数据从一个集群同步到另一个集群")]),a._v(" "),e("li",[a._v("减少消息消费的时延")])]),a._v(" "),e("h3",{attrs:{id:"federation-种类"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#federation-种类"}},[a._v("#")]),a._v(" Federation 种类")]),a._v(" "),e("p",[a._v("可以创建两种类型的 Federation，分别是 Exchange Federation 和 Queue Federation。")]),a._v(" "),e("h4",{attrs:{id:"exchange-federation"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#exchange-federation"}},[a._v("#")]),a._v(" Exchange Federation")]),a._v(" "),e("p",[a._v("简单说，它可以实现消息在 Exchange 间的复制（同步）。")]),a._v(" "),e("p",[a._v("使用 Exchange Federation 可以将消息发到其他集群。效果是，当消息发送到被联邦的 Exchange 时，消息会被发送到本地的 Exchange 和 下游的集群。这样，你就可以在不同的集群多次消费消息。")]),a._v(" "),e("h4",{attrs:{id:"queue-federation"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#queue-federation"}},[a._v("#")]),a._v(" Queue Federation")]),a._v(" "),e("p",[a._v("Queue Federation 的效果是消息的负载均衡，它只会将消息发往有空闲消费者的下游集群。也就是说，消息不会被复制。")]),a._v(" "),e("p",[a._v("常被用于分散压力和集群消息转移。")]),a._v(" "),e("h2",{attrs:{id:"使用前提"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#使用前提"}},[a._v("#")]),a._v(" 使用前提")]),a._v(" "),e("ul",[e("li",[a._v("两个 RabbitMQ 服务器或集群")]),a._v(" "),e("li",[a._v("在两个 RabbitMQ 上开启 Federation 插件")]),a._v(" "),e("li",[a._v("（可选）为 Federation 的组件单独创建用户")]),a._v(" "),e("li",[a._v("上下游 RabbitMQ 网络可以通过 AMQP 协议连接")])]),a._v(" "),e("h2",{attrs:{id:"federation-exchange-使用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#federation-exchange-使用"}},[a._v("#")]),a._v(" Federation Exchange 使用")]),a._v(" "),e("ol",[e("li",[a._v("满足使用前提")]),a._v(" "),e("li",[a._v("在下游节点配置 Federation 的 upstream")]),a._v(" "),e("li",[a._v("在下游节点配置 Policy，指定要被 Federate 的 Exchange 或 Queue")])]),a._v(" "),e("h3",{attrs:{id:"upstream-上游集群配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#upstream-上游集群配置"}},[a._v("#")]),a._v(" upstream 上游集群配置")]),a._v(" "),e("ol",[e("li",[a._v("创建 Exchange")])]),a._v(" "),e("p",[e("img",{attrs:{src:"https://scarb-images.oss-cn-hangzhou.aliyuncs.com/img/202203111245154.png",alt:"1. 创建 Exchange"}})]),a._v(" "),e("ol",{attrs:{start:"2"}},[e("li",[a._v("创建 Queue")])]),a._v(" "),e("p",[e("img",{attrs:{src:"https://scarb-images.oss-cn-hangzhou.aliyuncs.com/img/202203111250015.png",alt:"2. 创建 Queue"}})]),a._v(" "),e("ol",{attrs:{start:"3"}},[e("li",[a._v("绑定 Exchange 和 Queue")])]),a._v(" "),e("p",[e("img",{attrs:{src:"https://scarb-images.oss-cn-hangzhou.aliyuncs.com/img/202203111250347.png",alt:"3. 绑定 Exchange 和 Queue"}})]),a._v(" "),e("h3",{attrs:{id:"downstream-下游集群配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#downstream-下游集群配置"}},[a._v("#")]),a._v(" downstream 下游集群配置")]),a._v(" "),e("ol",[e("li",[a._v("配置 upstream")])]),a._v(" "),e("p",[e("img",{attrs:{src:"https://scarb-images.oss-cn-hangzhou.aliyuncs.com/img/202203111251414.png",alt:"1. 配置 upstream"}})]),a._v(" "),e("ol",{attrs:{start:"2"}},[e("li",[a._v("创建 Federation policy")])]),a._v(" "),e("p",[e("img",{attrs:{src:"https://scarb-images.oss-cn-hangzhou.aliyuncs.com/img/202203111251457.png",alt:"2. 创建 Federation 的 policy"}})]),a._v(" "),e("ol",{attrs:{start:"3"}},[e("li",[a._v("检查 Federation 状态")])]),a._v(" "),e("p",[e("img",{attrs:{src:"https://scarb-images.oss-cn-hangzhou.aliyuncs.com/img/202203111251640.png",alt:"3. 检查 Federation 状态"}})]),a._v(" "),e("h3",{attrs:{id:"测试"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#测试"}},[a._v("#")]),a._v(" 测试")]),a._v(" "),e("ul",[e("li",[a._v("在上游集群向 Exchange 发送消息")])]),a._v(" "),e("p",[e("img",{attrs:{src:"https://scarb-images.oss-cn-hangzhou.aliyuncs.com/img/202203111251635.png",alt:"在上游集群向 Exchange 发送消息"}})]),a._v(" "),e("ul",[e("li",[a._v("在上下游集群的队列都可以收到消息")])]),a._v(" "),e("p",[e("img",{attrs:{src:"https://scarb-images.oss-cn-hangzhou.aliyuncs.com/img/202203111252460.png",alt:"在上下游集群的队列都可以收到消息"}})]),a._v(" "),e("h2",{attrs:{id:"参考资料"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[a._v("#")]),a._v(" 参考资料")]),a._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://www.rabbitmq.com/federation.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("Federation Plugin"),e("OutboundLink")],1)]),a._v(" "),e("li",[e("a",{attrs:{href:"https://www.cloudamqp.com/blog/faq-what-is-the-rabbitmq-federation-plugin.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("FAQ: What is the RabbitMQ Federation plugin"),e("OutboundLink")],1)]),a._v(" "),e("li",[e("a",{attrs:{href:"https://jee-appy.blogspot.com/2018/08/setup-rabbitmq-exchange-federation.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("Setup RabbitMQ Exchange Federation"),e("OutboundLink")],1)])]),a._v(" "),e("hr"),a._v(" "),e("p",[a._v("欢迎关注公众号【消息中间件】（middleware-mq），更新消息中间件的源码解析和最新动态！")]),a._v(" "),e("p",[e("img",{attrs:{src:"https://scarb-images.oss-cn-hangzhou.aliyuncs.com/img/202205170102971.jpg",alt:""}})])])}),[],!1,null,null,null);t.default=s.exports}}]);