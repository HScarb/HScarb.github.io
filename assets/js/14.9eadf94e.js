(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{602:function(s,t,a){"use strict";a.r(t);var n=a(17),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("原文地址："),a("a",{attrs:{href:"http://hscarb.github.io/java/20220427-jmh.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://hscarb.github.io/java/20220427-jmh.html"),a("OutboundLink")],1)]),s._v(" "),a("h1",{attrs:{id:"java-性能优化神器-jmh-从入门到精通"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#java-性能优化神器-jmh-从入门到精通"}},[s._v("#")]),s._v(" Java 性能优化神器 JMH 从入门到精通")]),s._v(" "),a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#java-性能优化神器-jmh-从入门到精通"}},[s._v("Java 性能优化神器 JMH 从入门到精通")]),a("ul",[a("li",[a("a",{attrs:{href:"#背景"}},[s._v("背景")])]),a("li",[a("a",{attrs:{href:"#jmh-的意义"}},[s._v("JMH 的意义")]),a("ul",[a("li",[a("a",{attrs:{href:"#jmh-如何工作"}},[s._v("JMH 如何工作？")])])])]),a("li",[a("a",{attrs:{href:"#快速开始"}},[s._v("快速开始")]),a("ul",[a("li",[a("a",{attrs:{href:"#安装插件"}},[s._v("安装插件")])]),a("li",[a("a",{attrs:{href:"#使用-maven-archtype"}},[s._v("使用 Maven archtype")])]),a("li",[a("a",{attrs:{href:"#引入依赖"}},[s._v("引入依赖")])]),a("li",[a("a",{attrs:{href:"#编写测试代码"}},[s._v("编写测试代码")])]),a("li",[a("a",{attrs:{href:"#运行测试"}},[s._v("运行测试")])]),a("li",[a("a",{attrs:{href:"#查看结果"}},[s._v("查看结果")])])])]),a("li",[a("a",{attrs:{href:"#注释详解"}},[s._v("注释详解")])]),a("li",[a("a",{attrs:{href:"#高级用法"}},[s._v("高级用法")])]),a("li",[a("a",{attrs:{href:"#将结果图形化"}},[s._v("将结果图形化")])]),a("li",[a("a",{attrs:{href:"#参考资料"}},[s._v("参考资料")])])])])])]),a("p"),s._v(" "),a("h2",{attrs:{id:"背景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[s._v("#")]),s._v(" 背景")]),s._v(" "),a("p",[s._v("你在写 Java 高性能程序时有没有这样的场景：")]),s._v(" "),a("ul",[a("li",[s._v("纠结使用 ArrayList 还是 LinkedList 哪个更快？")]),s._v(" "),a("li",[s._v("进行运算时，怎么提高效率？使用 int 还是 long？")]),s._v(" "),a("li",[s._v("读写文件时，使用 FileChannel 还是 MappedByteBuffer 更快？")]),s._v(" "),a("li",[s._v("使用锁还是 synchronized？")]),s._v(" "),a("li",[s._v("使用 AtomicLong 还是 LongAdder 更快？")]),s._v(" "),a("li",[s._v("……")])]),s._v(" "),a("p",[s._v("特别是在写性能要求高的程序时，这些问题会更频繁地出现。有时上网查询可以找到答案，但是当遇到更复杂、独特的场景时可能就需要自己进行性能压测。")]),s._v(" "),a("p",[s._v("自己写一个测试方法或者 "),a("code",[s._v("Main")]),s._v(" 函数固然也可以，但是有没有更【专业】的工具？我们的神器 JMH 闪亮登场。")]),s._v(" "),a("p",[s._v("JMH 是 Java Microbenchmark Harness 的缩写，官方介绍如下：")]),s._v(" "),a("blockquote",[a("p",[s._v("JMH 是 OpenJDK 提供的 JVM 基准测试工具，用于测试 Java 和其他跑在 JVM 上语言程序的性能。")])]),s._v(" "),a("h2",{attrs:{id:"jmh-的意义"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jmh-的意义"}},[s._v("#")]),s._v(" JMH 的意义")]),s._v(" "),a("p",[s._v("当对一个程序的一小部分代码或者一个函数进行基准测试时，JVM 或底层硬件可能对这部分测试代码进行许多优化，但当这部分代码作为较大程序的一部分时可能无法应用这些优化。")]),s._v(" "),a("p",[s._v("自己实现基准测试代码时，编写的测试代码可能有缺陷。比如缺乏预热的步骤。")]),s._v(" "),a("p",[s._v("使用 JMH，你可以使用它提供的一系列注解轻松地编写基准测试代码。并且它通常会阻止 JVM 和硬件在基准测试时执行优化。此外它还能提供简单明了的基准测试结果输出，使用一些工具可以对该结果进行可视化。")]),s._v(" "),a("h3",{attrs:{id:"jmh-如何工作"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#jmh-如何工作"}},[s._v("#")]),s._v(" JMH 如何工作？")]),s._v(" "),a("p",[s._v("应用 JMH 注解的代码在编译之后会被编译成多个执行类以进行基准测试结果输出。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://scarb-images.oss-cn-hangzhou.aliyuncs.com/knowledge/2022/06/1654958778057.png",alt:""}})]),s._v(" "),a("p",[s._v("JMH 按照如上所示的流程进行基准测试。")]),s._v(" "),a("ul",[a("li",[s._v("Fork 为一个新的进程，如果设置用多个进程执行，则各个线程串行执行。")]),s._v(" "),a("li",[s._v("每个线程中先执行预热（Warmup），然后再执行测试（Measurement）。在预热和测试执行过程中，每一轮测试称为一个迭代（Iteration），一个迭代也是测试数据统计的最小单元。在 "),a("code",[s._v("@Warmup")]),s._v(" 和 "),a("code",[s._v("@Measurement")]),s._v(" 注解中可以指定执行的迭代次数和每次迭代的执行时常。")]),s._v(" "),a("li",[s._v("每个迭代中会根据基准测试的模式（"),a("code",[s._v("@BenchmarkMode")]),s._v("）来调用（Invoke）测试方法，可能一次也可能多次，并计算该测试模式所关注的指标。")]),s._v(" "),a("li",[s._v("可以看到在每次测试前后、每次迭代前后、甚至每次调用方法前后都可以用 "),a("code",[s._v("@Setup")]),s._v(" 和 "),a("code",[s._v("@TearDown")]),s._v(" 注解来设置启动和停止的方法。")])]),s._v(" "),a("h2",{attrs:{id:"快速开始"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#快速开始"}},[s._v("#")]),s._v(" 快速开始")]),s._v(" "),a("h3",{attrs:{id:"安装插件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装插件"}},[s._v("#")]),s._v(" 安装插件")]),s._v(" "),a("p",[s._v("使用 JMH 前最好先安装一下配套的 idea 插件。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://scarb-images.oss-cn-hangzhou.aliyuncs.com/img/202204182054455.png",alt:""}})]),s._v(" "),a("p",[s._v("它可以帮助解析 JMH 的注解。")]),s._v(" "),a("h3",{attrs:{id:"使用-maven-archtype"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用-maven-archtype"}},[s._v("#")]),s._v(" 使用 Maven archtype")]),s._v(" "),a("p",[s._v("官方推荐的使用方法是使用 Maven archtype 构建项目，这样可以自动生成基准测试代码，打包之后也自带可以运行基准测试代码的 "),a("code",[s._v("benchmark.jar")]),s._v(" 包。由于可能需要在 Linux 上测试，所以这个 jar 包十分有用。")]),s._v(" "),a("p",[s._v("运行如下代码使用 maven archtype 构建项目。")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("mvn archetype:generate "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  -DinteractiveMode"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("false "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  -DarchetypeGroupId"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("org.openjdk.jmh "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  -DarchetypeArtifactId"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("jmh-java-benchmark-archetype "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  -DgroupId"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("org.sample "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  -DartifactId"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("test "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  -Dversion"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v("\n")])])]),a("p",[s._v("如果使用 idea，可以使用 idea 添加 Archtype 后创建。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://scarb-images.oss-cn-hangzhou.aliyuncs.com/img/202204252257190.png",alt:""}}),s._v(" "),a("img",{attrs:{src:"https://scarb-images.oss-cn-hangzhou.aliyuncs.com/img/202204252258064.png",alt:""}})]),s._v(" "),a("h3",{attrs:{id:"引入依赖"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#引入依赖"}},[s._v("#")]),s._v(" 引入依赖")]),s._v(" "),a("p",[s._v("JMH 在 JDK9 之后的版本已经原生支持。在 JDK9 之前的版本需要引入依赖。当前最新的版本为 1.35。如果已经使用 Archtype 方式构建项目，那么无需额外引入依赖。")]),s._v(" "),a("div",{staticClass:"language-xml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("org.openjdk.jmh"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("jmh-core"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("1.35"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("org.openjdk.jmh"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("jmh-generator-annprocess"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("1.35"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("version")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependency")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])])]),a("h3",{attrs:{id:"编写测试代码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#编写测试代码"}},[s._v("#")]),s._v(" 编写测试代码")]),s._v(" "),a("p",[s._v("使用 Archtype 构建的项目已经写好了 "),a("code",[s._v("MyBenchmark")]),s._v(" 类，可以直接运行空测试函数。")]),s._v(" "),a("p",[s._v("我们编写代码来测试一下 "),a("code",[s._v("ArrayList")]),s._v(" 和 "),a("code",[s._v("LinkedList")]),s._v(" 添加数据的性能。假设需要测试分别向两种列表中添加 1000w 数据。")]),s._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 使用一个进程来运行测试，如果大于 1，多进程串行执行")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Fork")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 类变量的作用域，这里指 linkedList 和 arrayList 在同一个测试类中共享")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@State")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Scope"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Benchmark")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 预热执行 5 次，每次 1 秒")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Warmup")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("iterations "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" time "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 测试执行 5 次，每次 1 秒次")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Measurement")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("iterations "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" time "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 测试模式为计算测试方法的吞吐量（每秒执行次数）")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@BenchmarkMode")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Mode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Throughput")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 用例计时和输出的时间单位")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@OutputTimeUnit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("TimeUnit")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("MILLISECONDS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MyBenchmark")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LinkedList")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" linkedList"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("private")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ArrayList")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Integer")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v(" arrayList"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 初始化方法，在每次调用测试方法之前执行，类似 JUnit")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Level 表示该方法运行的时机，Iteration 表示每次测试都会执行（包括预热）")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Setup")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Level"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Iteration")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setup")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        linkedList "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("LinkedList")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        arrayList "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ArrayList")]),a("span",{pre:!0,attrs:{class:"token generics"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 测试方法，类似 JUnit @Test。标注了 @Benchmark 的方法会被进行基准测试")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Benchmark")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("testArrayList")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        arrayList"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Benchmark")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("testLinkedList")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        linkedList"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),a("h3",{attrs:{id:"运行测试"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#运行测试"}},[s._v("#")]),s._v(" 运行测试")]),s._v(" "),a("p",[s._v("在 idea 安装插件的情况下可以直接运行测试。")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://scarb-images.oss-cn-hangzhou.aliyuncs.com/img/202204252326481.png",alt:""}})]),s._v(" "),a("p",[s._v("另一种方式，可以通过 Archtype 的 benchmark.jar 来运行测试。")]),s._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("mvn clean verify\n")])])]),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[s._v("java -jar target/benchmarks.jar\n")])])]),a("h3",{attrs:{id:"查看结果"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看结果"}},[s._v("#")]),s._v(" 查看结果")]),s._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[s._v("# JMH version"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.35")]),s._v("\n# "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Blackhole")]),s._v(" mode"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" full "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" dont"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("inline hint "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("auto"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("detected"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" use "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Djmh")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("blackhole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("autoDetect"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("disable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n# "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Warmup")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" iterations"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" s each                      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 预热 5 次，每次 1 秒")]),s._v("\n# "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Measurement")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" iterations"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" s each                 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 测试 5 次，每次 1 秒")]),s._v("\n# "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Timeout")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" min per iteration                       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 每次执行测试方法的超时时间为 10 分钟")]),s._v("\n# "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Threads")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" thread"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" will synchronize iterations      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 单线程执行")]),s._v("\n# "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Benchmark")]),s._v(" mode"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Throughput")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ops"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("time                "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 测试模式：吞吐量，统计每秒操作数")]),s._v("\n# "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Benchmark")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("example"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),s._v("MyBenchmark")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("testArrayList    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 本次测试的测试方法")]),s._v("\n\n# "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Run")]),s._v(" progress"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v(" complete"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ETA "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("\n# "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Fork")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" of "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("                                        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 第一个进程执行测试")]),s._v("\n# "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Warmup")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Iteration")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("141579.663")]),s._v(" ops"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ms             "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 每次预热耗时")]),s._v("\n# "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Warmup")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Iteration")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13048.155")]),s._v(" ops"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ms\n# "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Warmup")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Iteration")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("126507.754")]),s._v(" ops"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ms\n# "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Warmup")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Iteration")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("127890.530")]),s._v(" ops"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ms\n# "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Warmup")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Iteration")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("152379.871")]),s._v(" ops"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ms\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Iteration")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("149509.372")]),s._v(" ops"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ms                      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 每次测试执行耗时")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Iteration")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("147695.938")]),s._v(" ops"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ms\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Iteration")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100544.988")]),s._v(" ops"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ms\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Iteration")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("169084.449")]),s._v(" ops"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ms\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Iteration")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("177057.200")]),s._v(" ops"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ms\n\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Result")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"org.example.MyBenchmark.testArrayList"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("148778.389")]),s._v(" ±"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("99.9")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("114555.755")]),s._v(" ops"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ms "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Average")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("min"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" avg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" max"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100544.988")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("148778.389")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("177057.200")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" stdev "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("29749.766")]),s._v("\n  CI "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("99.9")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("34222.635")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("263334.144")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("assumes normal distribution"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n# "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("\n# "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Benchmark")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("example"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),s._v("MyBenchmark")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("testLinkedList\n\n# "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Run")]),s._v(" progress"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50.00")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),s._v(" complete"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ETA "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("\n# "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Fork")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" of "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n# "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Warmup")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Iteration")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3997.950")]),s._v(" ops"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ms\n# "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Warmup")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Iteration")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9656.378")]),s._v(" ops"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ms\n# "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Warmup")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Iteration")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9767.753")]),s._v(" ops"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ms\n# "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Warmup")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Iteration")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8815.672")]),s._v(" ops"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ms\n# "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Warmup")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Iteration")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("47451.551")]),s._v(" ops"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ms\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Iteration")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("21131.024")]),s._v(" ops"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ms\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Iteration")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9101.728")]),s._v(" ops"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ms\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Iteration")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("28116.765")]),s._v(" ops"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ms\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Iteration")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8994.693")]),s._v(" ops"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ms\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Iteration")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("28290.489")]),s._v(" ops"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ms\n\n\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Result")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"org.example.MyBenchmark.testLinkedList"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19126.940")]),s._v(" ±"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("99.9")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("37132.831")]),s._v(" ops"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ms "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Average")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("min"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" avg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" max"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8994.693")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19126.940")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("28290.489")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" stdev "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9643.278")]),s._v("\n  CI "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("99.9")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("≈ "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("56259.771")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("assumes normal distribution"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n# "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Run")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("complete"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),s._v(" Total")]),s._v(" time"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("00")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("40")]),s._v("                 "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 所有测试执行完毕，耗时")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 测试结果，Mode 表示测试模式，thrpt 表示模式为 Throughput")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Score 表示平均耗时，Error 表示误差")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Benchmark")]),s._v("                    "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Mode")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Cnt")]),s._v("       "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Score")]),s._v("        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Error")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Units")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MyBenchmark")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("testArrayList   thrpt    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("148778.389")]),s._v(" ± "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("114555.755")]),s._v("  ops"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ms\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("MyBenchmark")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("testLinkedList  thrpt    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19126.940")]),s._v(" ±  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("37132.831")]),s._v("  ops"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("ms\n")])])]),a("h2",{attrs:{id:"注释详解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#注释详解"}},[s._v("#")]),s._v(" 注释详解")]),s._v(" "),a("p",[s._v("这个图片可以帮助快速查阅 JMH 各个注解的含义和用法。\n"),a("img",{attrs:{src:"https://scarb-images.oss-cn-hangzhou.aliyuncs.com/img/202204270021841.png",alt:""}})]),s._v(" "),a("p",[s._v("具体的解析可以看 "),a("a",{attrs:{href:"https://juejin.cn/post/7031008727645831176#heading-1",target:"_blank",rel:"noopener noreferrer"}},[s._v("关键注解"),a("OutboundLink")],1)]),s._v(" "),a("h2",{attrs:{id:"高级用法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#高级用法"}},[s._v("#")]),s._v(" 高级用法")]),s._v(" "),a("p",[s._v("详见 "),a("a",{attrs:{href:"https://juejin.cn/post/6844904147674726407",target:"_blank",rel:"noopener noreferrer"}},[s._v("基准测试神器JMH —— 详解36个官方例子"),a("OutboundLink")],1)]),s._v(" "),a("h2",{attrs:{id:"将结果图形化"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#将结果图形化"}},[s._v("#")]),s._v(" 将结果图形化")]),s._v(" "),a("h2",{attrs:{id:"参考资料"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考资料"}},[s._v("#")]),s._v(" 参考资料")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://www.cnkirito.moe/java-jmh",target:"_blank",rel:"noopener noreferrer"}},[s._v("JAVA 拾遗 — JMH 与 8 个测试陷阱"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://blog.csdn.net/yangbindxj/article/details/122899328",target:"_blank",rel:"noopener noreferrer"}},[s._v("JMH - Java 微基准测试工具（自助性能测试）@Benchmark"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://juejin.cn/post/7031008727645831176",target:"_blank",rel:"noopener noreferrer"}},[s._v("顶级Java才懂的，基准测试JMH！"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://juejin.cn/post/7069967034636845092",target:"_blank",rel:"noopener noreferrer"}},[s._v("JUC学习笔记 - 08JMH入门"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://juejin.cn/post/6844904147674726407",target:"_blank",rel:"noopener noreferrer"}},[s._v("基准测试神器JMH —— 详解36个官方例子"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://www.cnblogs.com/wupeixuan/p/13091381.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("性能调优必备利器之 JMH"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://jenkov.com/tutorials/java-performance/jmh.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("JMH - Java Microbenchmark Harness"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"http://leogomes.github.io/assets/JMH_cheatsheet.pdf",target:"_blank",rel:"noopener noreferrer"}},[s._v("JMH Cheatsheet"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://medium.com/javarevisited/understanding-java-microbenchmark-harness-or-jmh-tool-5b9b90ccbe8d",target:"_blank",rel:"noopener noreferrer"}},[s._v("Understanding Java Microbenchmark Harness or JMH Tool"),a("OutboundLink")],1)])]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("欢迎关注公众号【消息中间件】（middleware-mq），更新消息中间件的源码解析和最新动态！")]),s._v(" "),a("p",[a("img",{attrs:{src:"https://scarb-images.oss-cn-hangzhou.aliyuncs.com/img/202205170102971.jpg",alt:""}})])])}),[],!1,null,null,null);t.default=e.exports}}]);