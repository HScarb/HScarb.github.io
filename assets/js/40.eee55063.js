(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{628:function(e,s,a){"use strict";a.r(s);var t=a(17),o=Object(t.a)({},(function(){var e=this,s=e.$createElement,a=e._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"rocketmq-memory-store"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#rocketmq-memory-store"}},[e._v("#")]),e._v(" RocketMQ Memory Store")]),e._v(" "),a("h2",{attrs:{id:"背景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[e._v("#")]),e._v(" 背景")]),e._v(" "),a("h2",{attrs:{id:"概要设计"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#概要设计"}},[e._v("#")]),e._v(" 概要设计")]),e._v(" "),a("h3",{attrs:{id:"整体流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#整体流程"}},[e._v("#")]),e._v(" 整体流程")]),e._v(" "),a("p",[a("img",{attrs:{src:"https://scarb-images.oss-cn-hangzhou.aliyuncs.com/knowledge/2022/06/1655913092679.png",alt:""}})]),e._v(" "),a("p",[e._v("首先需要在 Broker 中创建 Topic，并指定为内存存储的 Topic。")]),e._v(" "),a("ol",[a("li",[e._v("生产者发送生产请求")]),e._v(" "),a("li",[a("code",[e._v("SendMessageProcessor")]),e._v(" 处理生产请求\n"),a("ol",[a("li",[e._v("根据请求的 Topic 获取 "),a("code",[e._v("TopicConfig")])]),e._v(" "),a("li",[e._v("判断该 Topic 是否是内存 Topic")]),e._v(" "),a("li",[e._v("如果不是，走原有 "),a("code",[e._v("DefaultMessageStore")]),e._v(" 存储")]),e._v(" "),a("li",[e._v("如果是，走 "),a("code",[e._v("MemoryMessageStore")]),e._v(" 存储")])])]),e._v(" "),a("li",[e._v("消费者发送拉取消息请求")]),e._v(" "),a("li",[a("code",[e._v("PullMessageProcessor")]),e._v(" 处理拉取消息请求\n"),a("ol",[a("li",[e._v("根据请求的 Topic 获取 "),a("code",[e._v("TopicConfig")])]),e._v(" "),a("li",[e._v("判断该 Topic 是否是内存 Topic")]),e._v(" "),a("li",[e._v("如果不是，走原有 "),a("code",[e._v("DefaultMessageStore")]),e._v(" 取消息")]),e._v(" "),a("li",[e._v("如果是，走 "),a("code",[e._v("MemoryMessageStore")]),e._v(" 取消息")])])])]),e._v(" "),a("h2",{attrs:{id:"详细设计"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#详细设计"}},[e._v("#")]),e._v(" 详细设计")]),e._v(" "),a("h3",{attrs:{id:"整体流程顺序图"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#整体流程顺序图"}},[e._v("#")]),e._v(" 整体流程顺序图")]),e._v(" "),a("p",[a("img",{attrs:{src:"https://scarb-images.oss-cn-hangzhou.aliyuncs.com/knowledge/2022/06/1655913092893.png",alt:""}})]),e._v(" "),a("h3",{attrs:{id:"类设计"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#类设计"}},[e._v("#")]),e._v(" 类设计")]),e._v(" "),a("h4",{attrs:{id:"memorymessagestore"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#memorymessagestore"}},[e._v("#")]),e._v(" MemoryMessageStore")]),e._v(" "),a("p",[a("img",{attrs:{src:"https://scarb-images.oss-cn-hangzhou.aliyuncs.com/knowledge/2022/06/1655913092916.png",alt:""}})]),e._v(" "),a("ul",[a("li",[a("p",[e._v("为 "),a("code",[e._v("MemoryMessageStore")]),e._v(" 设置一个存储阈值，为内存中存储的消息总大小，默认为可用内存的 75%")])]),e._v(" "),a("li",[a("p",[a("code",[e._v("messageQueueMap")]),e._v("：一个 "),a("code",[e._v("HashMap")]),e._v("，Key 是 Topic 名称，Value 是 Disruptor 存储的 "),a("code",[e._v("MessageExtBrokerInner")]),e._v(" 消息队列")])]),e._v(" "),a("li",[a("p",[a("code",[e._v("messageTotalSize")]),e._v("：记录保存的消息总大小")])]),e._v(" "),a("li",[a("p",[a("code",[e._v("putMessage")]),e._v("：将消息根据 Topic 放入指定队列，如果超过消息总大小阈值，则从该 Topic 中删除一条消息。如果该 Topic 为空，则删除一条保存最久的消息")])])]),e._v(" "),a("h4",{attrs:{id:"topicconfig"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#topicconfig"}},[e._v("#")]),e._v(" TopicConfig")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("boolean memory")]),e._v("：是否是内存 Topic")])]),e._v(" "),a("h4",{attrs:{id:"brokercontroller"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#brokercontroller"}},[e._v("#")]),e._v(" BrokerController")]),e._v(" "),a("ul",[a("li",[a("code",[e._v("memoryTopicEnable")]),e._v("：是否启动内存 Topic 功能，默认 false")])]),e._v(" "),a("hr"),e._v(" "),a("p",[e._v("欢迎关注公众号【消息中间件】（middleware-mq），更新消息中间件的源码解析和最新动态！")]),e._v(" "),a("p",[a("img",{attrs:{src:"https://scarb-images.oss-cn-hangzhou.aliyuncs.com/img/202205170102971.jpg",alt:""}})])])}),[],!1,null,null,null);s.default=o.exports}}]);