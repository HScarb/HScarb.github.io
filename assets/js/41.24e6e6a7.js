(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{629:function(s,a,t){"use strict";t.r(a);var e=t(17),r=Object(e.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"使用-docker-和-docker-compose-快速部署-rocketmq-集群-双主-dledger"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用-docker-和-docker-compose-快速部署-rocketmq-集群-双主-dledger"}},[s._v("#")]),s._v(" 使用 Docker 和 docker-compose 快速部署 RocketMQ 集群 双主 / DLedger")]),s._v(" "),t("h2",{attrs:{id:"背景"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[s._v("#")]),s._v(" 背景")]),s._v(" "),t("p",[s._v("RocketMQ 的部署和配置较为复杂，有众多配置项和部署方式可以选择。用户往往难以快速部署 RocketMQ，进行开发和验证。")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://github.com/apache/rocketmq-docker",target:"_blank",rel:"noopener noreferrer"}},[s._v("rocketmq-docker"),t("OutboundLink")],1),s._v(" 这个项目提供了 RocketMQ 的 docker 镜像打包实现，并且提供了常用的 docker-compose 模板，可以很快地用 Docker 启动 RocketMQ，并支持多种部署模式。")]),s._v(" "),t("h2",{attrs:{id:"环境准备"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#环境准备"}},[s._v("#")]),s._v(" 环境准备")]),s._v(" "),t("p",[s._v("需要安装完成 Docker，并且可以连接 Docker Hub。然后用 git 拉取 rocketmq-docker 仓库，并进入该仓库。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone https://github.com/apache/rocketmq-docker.git\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" rocketmq-docker\n")])])]),t("h2",{attrs:{id:"镜像准备"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#镜像准备"}},[s._v("#")]),s._v(" 镜像准备")]),s._v(" "),t("p",[s._v("可以预先准备好 RocketMQ 的镜像。本地构建或者从 Docker Hub 拉取官方打包的镜像都可以")]),s._v(" "),t("h3",{attrs:{id:"本地构建-rocketmq-docker-镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#本地构建-rocketmq-docker-镜像"}},[s._v("#")]),s._v(" 本地构建 RocketMQ docker 镜像")]),s._v(" "),t("p",[s._v("这一步不是必须要的，也可以从 Docker Hub 中拉取官方镜像。")]),s._v(" "),t("p",[s._v("本地构建的最大意义在于，如果自己修改了 RocketMQ 的源码，则可以用这种方式构建自己的镜像。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" image-build\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" build-image.sh RMQ-VERSION BASE-IMAGE\n")])])]),t("p",[s._v("运行脚本之后，会拉取响应版本的 RocketMQ 安装包到本地，然后构建镜像包。")]),s._v(" "),t("p",[s._v("其中 "),t("code",[s._v("RMQ-VERSION")]),s._v(" 是需要构建的 RocketMQ 版本，在 "),t("a",{attrs:{href:"https://archive.apache.org/dist/rocketmq/",target:"_blank",rel:"noopener noreferrer"}},[s._v("这个地方"),t("OutboundLink")],1),s._v(" 查看可选版本列表。")]),s._v(" "),t("p",[t("code",[s._v("BASE-IMAGE")]),s._v(" 可以在 "),t("code",[s._v("centos")]),s._v(" 和 "),t("code",[s._v("alpine")]),s._v(" 中选择。比如当前最新版本为 4.9.4，那么可以用如下命令打镜像")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" build-image.sh "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.9")]),s._v(".4 alpine\n")])])]),t("p",[s._v("打包完成后可以用如下命令查看")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" images\nREPOSITORY                          TAG            IMAGE ID       CREATED         SIZE\napacherocketmq/rocketmq             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.9")]),s._v(".4-alpine   58e1e7a5e556   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(" hours ago    188MB\n")])])]),t("h3",{attrs:{id:"拉取远程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#拉取远程"}},[s._v("#")]),s._v(" 拉取远程")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" search rocketmq\nNAME                                 DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED\nfoxiswho/rocketmq                    rocketmq                                        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("77")]),s._v("                   \nrocketmqinc/rocketmq                 Image repository "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" Apache RocketMQ            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("54")]),s._v("                   \nstyletang/rocketmq-console-ng        rocketmq-console-ng                             "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("38")]),s._v("                   \napache/rocketmq                                                                      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v("                   \napacherocketmq/rocketmq              Docker Image "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" Apache RocketMQ                "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v("                   \n")])])]),t("p",[s._v("我们选择 "),t("code",[s._v("apache/rocketmq")]),s._v("，其他的版本已经跟不上时代了，年久失修。")]),s._v(" "),t("p",[s._v("看一下它支持的版本号列表：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://scarb-images.oss-cn-hangzhou.aliyuncs.com/img/202207241613503.png",alt:""}})]),s._v(" "),t("p",[s._v("选择最新的 4.9.4 版本拉取")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" pull apache/rocketmq:4.9.4\n")])])]),t("h2",{attrs:{id:"docker-启动-rocketmq"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker-启动-rocketmq"}},[s._v("#")]),s._v(" Docker 启动 RocketMQ")]),s._v(" "),t("p",[s._v("首先需要用版本号来创建一个 stage 文件夹，运行如下命令")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" stage.sh "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.9")]),s._v(".4\n")])])]),t("p",[s._v("会在根目录下创建一个 "),t("code",[s._v("stage")]),s._v(" 文件夹，进入到 "),t("code",[s._v("stage/4.9.4/templates")]),s._v(" 目录下（有的 Linux 系统生成的路径是 "),t("code",[s._v("stage/4.9.4/")]),s._v("）")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" stages/4.9.4/templates/\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" -l\ndrwxrwxr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" ubuntu ubuntu "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Jul "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":25 ./\ndrwxrwxr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" ubuntu ubuntu "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Jul "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":23 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/\ndrwxrwxr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" ubuntu ubuntu "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Jul "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":23 data/\ndrwxrwxr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" ubuntu ubuntu "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Jul "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":26 docker-compose/\ndrwxrwxr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" ubuntu ubuntu "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Jul "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":23 kubernetes/\n-rwxrwxr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" ubuntu ubuntu  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("902")]),s._v(" Jul "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":23 play-consumer.sh*\n-rwxrwxr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" ubuntu ubuntu "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1497")]),s._v(" Jul "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":23 play-docker-compose.sh*\n-rwxrwxr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" ubuntu ubuntu "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3201")]),s._v(" Jul "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":23 play-docker-dledger.sh*\n-rwxrwxr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" ubuntu ubuntu "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2354")]),s._v(" Jul "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":23 play-docker.sh*\n-rwxrwxr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" ubuntu ubuntu "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2271")]),s._v(" Jul "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":23 play-docker-tls.sh*\n-rwxrwxr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" ubuntu ubuntu  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("947")]),s._v(" Jul "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":23 play-kubernetes.sh*\n-rwxrwxr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" ubuntu ubuntu  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("901")]),s._v(" Jul "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":23 play-producer.sh*\ndrwxrwxr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" ubuntu ubuntu "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Jul "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":23 ssl/\n")])])]),t("p",[s._v("具体的原理是用原来 "),t("code",[s._v("templates")]),s._v(" 下的模板，替换内容中的版本号，生成 4.9.4 版本的启动脚本。")]),s._v(" "),t("p",[s._v("其中的多个 "),t("code",[s._v(".sh")]),s._v(" 文件是用来以不同部署方式启动 RocketMQ")]),s._v(" "),t("h3",{attrs:{id:"用-docker-compose-以集群模式启动-rocketmq"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#用-docker-compose-以集群模式启动-rocketmq"}},[s._v("#")]),s._v(" 用 docker-compose 以集群模式启动 RocketMQ")]),s._v(" "),t("p",[s._v("如果是采用远程拉取的镜像，首选需要修改一下 "),t("code",[s._v("docker-compose.yml")]),s._v(" 文件保证使用的镜像名称正确。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("pwd")]),s._v("\n/home/ubuntu/workspace/rocketmq/rocketmq-docker/stages/4.9.4/templates\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" docker-compose/docker-compose.yml\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# （如果拉取远程镜像）把其中默认的 image 从 apacherocketmq/rocketmq:4.9.4 改成 apache/rocketmq:4.9.4")]),s._v("\n$ ./play-docker-compose.sh \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("+"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Running "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("/4\n ⠿ Network docker-compose_default  Created                                                                                       \n ⠿ Container rmqnamesrv            Started                                                                                       \n ⠿ Container rmqbroker-b           Started                                                                                       \n ⠿ Container rmqbroker             Started                                         \n")])])]),t("p",[s._v("运行之后会启动两个 broker 和一个 nameserver")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\nCONTAINER ID   IMAGE                                     COMMAND                  CREATED              STATUS              PORTS                                                                                                                                                   NAMES\n722c5c14d3d0   apache/rocketmq:4.9.4                     "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sh mqbroker -c /opt…"')]),s._v("   About a minute ago   Up About a minute   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:10909-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10909")]),s._v("/tcp, :::10909-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10909")]),s._v("/tcp, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9876")]),s._v("/tcp, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:10911-10912-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10911")]),s._v("-10912/tcp, :::10911-10912-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10911")]),s._v("-10912/tcp                          rmqbroker\na7d0e64c5335   apache/rocketmq:4.9.4                     "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sh mqbroker -c /opt…"')]),s._v("   About a minute ago   Up About a minute   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9876")]),s._v("/tcp, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:10929-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10909")]),s._v("/tcp, :::10929-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10909")]),s._v("/tcp, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:10931-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10911")]),s._v("/tcp, :::10931-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10911")]),s._v("/tcp, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:10932-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10912")]),s._v("/tcp, :::10932-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10912")]),s._v("/tcp   rmqbroker-b\na210d64eddb5   apache/rocketmq:4.9.4                     "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sh mqnamesrv"')]),s._v("           About a minute ago   Up About a minute   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10909")]),s._v("/tcp, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:9876-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9876")]),s._v("/tcp, :::9876-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9876")]),s._v("/tcp, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10911")]),s._v("-10912/tcp                                                                                   rmqnamesrv\n")])])]),t("h2",{attrs:{id:"启动-rocketmq-dashboard"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#启动-rocketmq-dashboard"}},[s._v("#")]),s._v(" 启动 RocketMQ-dashboard")]),s._v(" "),t("p",[s._v("RocketMQ-dashboard 项目是 rocketmq 的控制台，可以可视化的查看 rocketmq 集群状态。也可以用 docker 启动。直接使用官方打包好的镜像，不本地构建了。")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://scarb-images.oss-cn-hangzhou.aliyuncs.com/img/202207241636060.png",alt:""}})]),s._v(" "),t("h3",{attrs:{id:"用-docker-启动-rocketmq-dashboard"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#用-docker-启动-rocketmq-dashboard"}},[s._v("#")]),s._v(" 用 docker 启动 rocketmq-dashboard")]),s._v(" "),t("p",[s._v("需要先修改 "),t("code",[s._v("start-dashboard.sh")]),s._v(" 文件")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("pwd")]),s._v("\n/home/ubuntu/workspace/rocketmq/rocketmq-docker\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" product/start-dashboard.sh\n")])])]),t("p",[s._v("将镜像名称改成 "),t("code",[s._v("apacherocketmq/rocketmq-dashboard")])]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改后")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ROCKETMQ_DASHBOARD_VERSION")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$1")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run -d -it --name rocketmq-dashboard -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6765")]),s._v(":8080 apacherocketmq/rocketmq-dashboard:"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${ROCKETMQ_DASHBOARD_VERSION}")]),s._v("\n")])])]),t("p",[s._v("然后运行")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" start-dashboard.sh "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v(".0\n")])])]),t("p",[s._v("会启动 rocketmq-dashboard 的 container")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\nCONTAINER ID   IMAGE                                     COMMAND                  CREATED          STATUS          PORTS                                                                                                                                                   NAMES\n433021cbeb23   apacherocketmq/rocketmq-dashboard:1.0.0   "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"sh -c 'java "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$JAVA_O")]),s._v('…"')]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("45")]),s._v(" minutes ago   Up "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("45")]),s._v(" minutes   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:6765-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("/tcp, :::6765-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("/tcp                                                                                                               rocketmq-dashboard\n")])])]),t("p",[s._v("这样启动之后，登录访问 "),t("code",[s._v("host:6765")]),s._v(" 地址，设置集群的 nameserver 地址，但是与集群的网络不通。")]),s._v(" "),t("h3",{attrs:{id:"与集群一起用-docker-compose-启动-docker-dashboard"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#与集群一起用-docker-compose-启动-docker-dashboard"}},[s._v("#")]),s._v(" 与集群一起用 docker-compose 启动 docker-dashboard")]),s._v(" "),t("p",[s._v("还是要修改 "),t("code",[s._v("docker-compose.yml")]),s._v(" 文件")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" stages/4.9.4/templates\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" docker-compose/docker-compose.yml\n")])])]),t("p",[s._v("在文件尾部添加如下配置，启动一个 rocketmq-dashboard 服务，并置于和集群同一个网络下")]),s._v(" "),t("div",{staticClass:"language-yml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yml"}},[t("code",[s._v("  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Service for dashboard ")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("dashboard")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" apacherocketmq/rocketmq"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("dashboard"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("1.0.0 \n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("container_name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rmq"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("dashboard \n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" 48080"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v(" \n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("environment")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" NAMESRV_ADDR=namesrv"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9876")]),s._v(" \n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("depends_on")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" namesrv \n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("links")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" \n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" namesrv \n")])])]),t("p",[s._v("然后访问 "),t("code",[s._v("host:48080")]),s._v(" 地址，可以通过 dashboard 查看集群状态")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://scarb-images.oss-cn-hangzhou.aliyuncs.com/img/202207250040182.png",alt:""}})]),s._v(" "),t("h2",{attrs:{id:"docker-启动-dledger-模式的-rocketmq"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker-启动-dledger-模式的-rocketmq"}},[s._v("#")]),s._v(" Docker 启动 DLedger 模式的 RocketMQ")]),s._v(" "),t("p",[s._v("用 DLedger 模式前保证有足够的可用内存（8G 以上）")]),s._v(" "),t("p",[s._v("也是有两种方法，用本地构建的镜像和 Docker Hub 中官方上传的镜像。如果用本地打包的镜像，直接运行如下命令")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" stages/4.9.4/templates\n$ ./play-docker-dledger.sh\n")])])]),t("p",[s._v("如果要用 Docker Hub 中的镜像，则需要修改 "),t("code",[s._v("play-docker-dledger.sh")]),s._v(" 中的镜像地址")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" play-docker-dledger.sh\n:%s/apacherocketmq/apache/g\n$ ./play-docker-dledger.sh\n")])])]),t("p",[s._v("但是我运行时三个 Broker 都未启动成功，查看 Broker 日志，发现 "),t("code",[s._v("broker.conf")]),s._v(" 文件未找到")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("ubuntu@VM-4-14-ubuntu:~/workspace/rocketmq/rocketmq-docker/stages/4.9.4/templates$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v("\nCONTAINER ID   IMAGE                   COMMAND                  CREATED         STATUS         PORTS                                                                                                                                NAMES\n1ae8a853012b   apache/rocketmq:4.9.4   "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sh mqbroker -c ../c…"')]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" seconds ago   Up "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" second    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9876")]),s._v("/tcp, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10909")]),s._v("/tcp, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:30929-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30929")]),s._v("/tcp, :::30929-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30929")]),s._v("/tcp, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10911")]),s._v("-10912/tcp, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:30931-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30931")]),s._v("/tcp, :::30931-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30931")]),s._v("/tcp   rmqbroker2\n71da5cd67513   apache/rocketmq:4.9.4   "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sh mqnamesrv"')]),s._v("           "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" seconds ago   Up "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" seconds   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10909")]),s._v("/tcp, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:9876-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9876")]),s._v("/tcp, :::9876-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9876")]),s._v("/tcp, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10911")]),s._v("-10912/tcp                                                                rmqnamesrv\n0e80d1d53112   redis:6.2               "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"docker-entrypoint.s…"')]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" months ago    Up "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" months    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:46379-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v("/tcp, :::46379-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v("/tcp                                                                                          redis-redis-1\nubuntu@VM-4-14-ubuntu:~/workspace/rocketmq/rocketmq-docker/stages/4.9.4/templates$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" -a\nCONTAINER ID   IMAGE                                     COMMAND                  CREATED          STATUS                       PORTS                                                                   NAMES\n1ae8a853012b   apache/rocketmq:4.9.4                     "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sh mqbroker -c ../c…"')]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" seconds ago    Exited "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("255")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" seconds ago                                                                           rmqbroker2\nb959cf8b6542   apache/rocketmq:4.9.4                     "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sh mqbroker -c ../c…"')]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" seconds ago    Exited "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("255")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" seconds ago                                                                           rmqbroker1\n919ce578e6db   apache/rocketmq:4.9.4                     "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sh mqbroker -c ../c…"')]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" seconds ago   Exited "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("255")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" seconds ago                                                                           rmqbroker\n71da5cd67513   apache/rocketmq:4.9.4                     "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sh mqnamesrv"')]),s._v("           "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" seconds ago   Up "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" seconds                 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10909")]),s._v("/tcp, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:9876-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9876")]),s._v("/tcp, :::9876-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9876")]),s._v("/tcp, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10911")]),s._v("-10912/tcp   rmqnamesrv\n\nubuntu@VM-4-14-ubuntu:~/workspace/rocketmq/rocketmq-docker/stages/4.9.4/templates$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" logs -t rmqbroker --tail"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-07-27T15:58:11.218761998Z java.io.FileNotFoundException: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/conf/dledger/broker.conf "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("No such "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" or directory"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-07-27T15:58:11.218878131Z  at java.io.FileInputStream.open0"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("Native Method"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-07-27T15:58:11.218887204Z  at java.io.FileInputStream.open"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("FileInputStream.java:195"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-07-27T15:58:11.218891884Z  at java.io.FileInputStream."),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("init"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("FileInputStream.java:138"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-07-27T15:58:11.218953791Z  at java.io.FileInputStream."),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("init"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("FileInputStream.java:93"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-07-27T15:58:11.218960481Z  at org.apache.rocketmq.broker.BrokerStartup.createBrokerController"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("BrokerStartup.java:119"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("-07-27T15:58:11.218965349Z  at org.apache.rocketmq.broker.BrokerStartup.main"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("BrokerStartup.java:57"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),t("p",[s._v("于是想办法修改 "),t("code",[s._v("play-docker-dledger.sh")]),s._v(" 中的 Broker 配置文件路径，改成 "),t("code",[s._v("/opt/rocketmq-4.9.4/conf/dledger/broker.conf")]),s._v("，然后启动成功")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://scarb-images.oss-cn-hangzhou.aliyuncs.com/img/202207280025262.png",alt:""}})]),s._v(" "),t("h4",{attrs:{id:"修改内存配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#修改内存配置"}},[s._v("#")]),s._v(" 修改内存配置")]),s._v(" "),t("p",[s._v("DLedger 模式默认配置下，每个节点会占用 2G 内存。如果是内存较小的机器则可以通过定义环境变量修改内存占用。")]),s._v(" "),t("p",[s._v("RocketMQ 使用 "),t("code",[s._v("runbroker.sh")]),s._v(" 启动，其中启动参数设置脚本如下：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# runbroker.sh")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_OPT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JAVA_OPT}")]),s._v(' -server -Xms8g -Xmx8g"')]),s._v("\nchoose_gc_options\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_OPT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JAVA_OPT}")]),s._v(' -XX:-OmitStackTraceInFastThrow"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_OPT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JAVA_OPT}")]),s._v(' -XX:+AlwaysPreTouch"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_OPT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JAVA_OPT}")]),s._v(' -XX:MaxDirectMemorySize=15g"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_OPT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JAVA_OPT}")]),s._v(' -XX:-UseLargePages -XX:-UseBiasedLocking"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#JAVA_OPT="${JAVA_OPT} -Xdebug -Xrunjdwp:transport=dt_socket,address=9555,server=y,suspend=n"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_OPT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JAVA_OPT}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JAVA_OPT_EXT}")]),s._v('"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JAVA_OPT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JAVA_OPT}")]),s._v(" -cp "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${CLASSPATH}")]),s._v('"')]),s._v("\n")])])]),t("p",[s._v("这个脚本预留了定义额外的 Java 启动参数的环境变量，即 "),t("code",[s._v("JAVA_OPT_EXT")]),s._v("，于是将 "),t("code",[s._v("play-docker-dledger.sh")]),s._v(" 文件做如下修改，添加 "),t("code",[s._v('-e "JAVA_OPT_EXT=-server -Xms128m -Xmx128m -Xmn128m"')]),s._v("（注意，这么小的内存无法生产消费消息，仅仅为了启动 Broker。需要同时改动 broker 配置中的 commitlog、consumequeue、indexfile 大小）")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run --net dledger-br --ip "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.18")]),s._v(".0.12 -d -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30911")]),s._v(":30911 -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30909")]),s._v(":30909 -v "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("pwd")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("/data/broker0/logs:/home/rocketmq/logs -v "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("pwd")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("/data/broker0/store:/home/rocketmq/store -v "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("pwd")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("/data/broker0/conf/dledger:/opt/rocketmq-4.9.4/conf/dledger --name rmqbroker --link rmqnamesrv:namesrv -e "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"NAMESRV_ADDR=namesrv:9876"')]),s._v(" -e "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"JAVA_OPT_EXT=-server -Xms128m -Xmx128m -Xmn128m"')]),s._v(" apache/rocketmq:4.9.4 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" mqbroker -c /opt/rocketmq-4.9.4/conf/dledger/broker.conf\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run --net dledger-br --ip "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.18")]),s._v(".0.13 -d -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30921")]),s._v(":30921 -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30919")]),s._v(":30919 -v "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("pwd")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("/data/broker1/logs:/home/rocketmq/logs -v "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("pwd")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("/data/broker1/store:/home/rocketmq/store -v "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("pwd")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("/data/broker1/conf/dledger:/opt/rocketmq-4.9.4/conf/dledger --name rmqbroker1 --link rmqnamesrv:namesrv -e "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"NAMESRV_ADDR=namesrv:9876"')]),s._v(" -e "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"JAVA_OPT_EXT=-server -Xms128m -Xmx128m -Xmn128m"')]),s._v(" apache/rocketmq:4.9.4 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" mqbroker -c /opt/rocketmq-4.9.4/conf/dledger/broker.conf\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run --net dledger-br --ip "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.18")]),s._v(".0.14 -d -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30931")]),s._v(":30931 -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30929")]),s._v(":30929 -v "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("pwd")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("/data/broker2/logs:/home/rocketmq/logs -v "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("pwd")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("/data/broker2/store:/home/rocketmq/store -v "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("pwd")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("/data/broker2/conf/dledger:/opt/rocketmq-4.9.4/conf/dledger --name rmqbroker2 --link rmqnamesrv:namesrv -e "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"NAMESRV_ADDR=namesrv:9876"')]),s._v(" -e "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"JAVA_OPT_EXT=-server -Xms128m -Xmx128m -Xmn128m"')]),s._v(" apache/rocketmq:4.9.4 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" mqbroker -c /opt/rocketmq-4.9.4/conf/dledger/broker.conf\n")])])]),t("h4",{attrs:{id:"dledger-与-dashboard-同时启动"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dledger-与-dashboard-同时启动"}},[s._v("#")]),s._v(" DLedger 与 Dashboard 同时启动")]),s._v(" "),t("p",[s._v("需要修改 "),t("code",[s._v("play-docker-dleger.sh")]),s._v("，在 broker 运行的脚本下面添加 dashboard 的 docker 运行脚本，并与 broker、nameserver 用同一个网络")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Start brokers")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ...")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Start dashboard")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" run --net dledger-br -d -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("48080")]),s._v(":8080 --link rmqnamesrv:namesrv -e "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"NAMESRV_ADDR=namesrv:9876"')]),s._v(" --name rmq-dledger-dashboard apacherocketmq/rocketmq-dashboard:1.0.0\n")])])]),t("p",[s._v("然后运行 "),t("code",[s._v("./play-docker-dledger.sh")]),s._v("，可以访问 "),t("code",[s._v("48080")]),s._v(" 端口进入 Dashboard")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://scarb-images.oss-cn-hangzhou.aliyuncs.com/img/202208020138914.png",alt:""}})]),s._v(" "),t("p",[t("img",{attrs:{src:"https://scarb-images.oss-cn-hangzhou.aliyuncs.com/img/202208020138935.png",alt:""}})]),s._v(" "),t("h2",{attrs:{id:"以其他部署形式启动-rocketmq"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#以其他部署形式启动-rocketmq"}},[s._v("#")]),s._v(" 以其他部署形式启动 RocketMQ")]),s._v(" "),t("h3",{attrs:{id:"docker-启动单节点-rocketmq"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker-启动单节点-rocketmq"}},[s._v("#")]),s._v(" Docker 启动单节点 RocketMQ")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" stages/4.9.4/templates\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" play-docker.sh alpine\n")])])]),t("h3",{attrs:{id:"docker-启动带-tls-的-rocketmq"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker-启动带-tls-的-rocketmq"}},[s._v("#")]),s._v(" Docker 启动带 TLS 的 RocketMQ")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" stages/4.9.4/templates\n$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sh")]),s._v(" play-docker-tls.sh\n")])])]),t("hr"),s._v(" "),t("p",[s._v("欢迎关注公众号【消息中间件】（middleware-mq），更新消息中间件的源码解析和最新动态！")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://scarb-images.oss-cn-hangzhou.aliyuncs.com/img/202205170102971.jpg",alt:""}})])])}),[],!1,null,null,null);a.default=r.exports}}]);